# JSON/JSONC Contracts

**Status:** Canonical source of truth for JSON/JSONC formatting requirements  
**Last Updated:** 2026-01-08  
**Enforcement:** Enforced via `prettier` in `repo-lint check --ci`

## Overview

This document defines the mandatory JSON/JSONC formatting and style requirements for the RFC-Shared-Agent-Scaffolding
repository. These standards ensure consistency, readability, and maintainability across all JSON and JSONC
configuration files.

**Key Principle:** All JSON/JSONC files must follow a consistent, deterministic style that is machine-checkable and
auto-fixable.

---

## Scope

### Files Enforced

**Default:** All `*.json` and `*.jsonc` files in the repository are subject to JSON/JSONC linting.

**Included files:**

- `.markdownlint-cli2.jsonc` (Markdown linter configuration)
- `conformance/**/*.json` (Conformance test vectors)
- `.vscode/*.json` (VS Code configuration files, if any)
- `package.json` (Node.js package metadata, if any)
- `tsconfig.json` (TypeScript configuration, if any)
- Any future `*.json` or `*.jsonc` configuration files

### Exclusions

The following files/directories are **explicitly excluded** from JSON/JSONC linting:

1. **Vendored/third-party files:** (none currently)
   - **Future:** If external JSON files are vendored, add exclusions here

2. **Build artifacts:** Any `*.json` files in build output directories (`dist/`, `build/`, etc.)

3. **Temporary/scratch files:** Any `*.json` files in `/tmp/` or temporary locations

4. **Lock files with auto-generated content:**
   - `package-lock.json` (if present) - auto-generated by npm
   - **Rationale:** Lock files are managed by package managers and should not be manually formatted

**Important:** Exclusions MUST be documented with a clear reason. Avoid broad exclusions.

---

## Ruleset

### Rule Philosophy

This ruleset follows **JSON Best Practices** from authoritative sources:

- [JSON Specification (RFC 8259)](https://datatracker.ietf.org/doc/html/rfc8259) - Official JSON specification
- [Prettier JSON Style Guide](https://prettier.io/docs/en/options.html) - Industry-standard formatter
- [JSON5 Specification](https://json5.org/) - Extended JSON format (for JSONC)

**Core Principles:**

- **Prefer machine-fixable rules** to reduce manual effort
- **No vague rules:** Every rule must be deterministic and checkable
- **Compatibility first:** Rules must work with standard JSON and JSONC
- **Readability:** JSON files should be easy to read and edit by humans
- **Consistency:** Use one style throughout the repository

### Core Rules (MANDATORY)

#### 1. Indentation and Whitespace

**Indentation:** Use **2 spaces** for indentation (Prettier default, JSON standard convention)

**Rationale:** 2 spaces provide good readability while conserving horizontal space in nested objects/arrays.

```json
{
  "name": "example",
  "config": {
    "enabled": true,
    "options": ["opt1", "opt2"]
  }
}
```

**Trailing whitespace:** NOT allowed on any line

**Final newline:** Files MUST end with a single newline character

#### 2. Quotes and Strings

**String quotes:** Use **double quotes** (`"`) for all strings (JSON spec requirement)

**Rationale:** JSON specification requires double quotes. JSONC follows the same convention for consistency.

```json
// ✅ Correct - double quotes
{
  "key": "value"
}

// ❌ Incorrect - single quotes not valid in JSON
{
  'key': 'value'
}
```

#### 3. Arrays and Objects

**Array formatting:**
- Short arrays (≤3 items, fits in 80 chars): Keep on one line
- Long arrays: One item per line with trailing comma on last item (JSONC only)

```json
// ✅ Correct - short array on one line
{
  "tags": ["tag1", "tag2", "tag3"]
}

// ✅ Correct - long array with items on separate lines
{
  "dependencies": [
    "package-one",
    "package-two",
    "package-three"
  ]
}
```

**Object formatting:**
- Short objects (fits in 80 chars): Keep on one line
- Long objects: One property per line

```json
// ✅ Correct - short object
{
  "point": { "x": 10, "y": 20 }
}

// ✅ Correct - long object
{
  "config": {
    "host": "localhost",
    "port": 8080,
    "timeout": 30000
  }
}
```

#### 4. Commas and Separators

**Trailing commas:**
- **JSON (`.json`):** NOT allowed (JSON spec forbids trailing commas)
- **JSONC (`.jsonc`):** Allowed and preferred for better diffs

**Rationale:** JSONC allows trailing commas which improve git diffs when adding items. Standard JSON does not support
trailing commas.

```json
// ✅ Correct for .json files
{
  "items": [
    "item1",
    "item2"
  ]
}
```

```jsonc
// ✅ Correct for .jsonc files
{
  "items": [
    "item1",
    "item2",  // trailing comma allowed in JSONC
  ],
}
```

**Comma spacing:** One space after commas, no space before

#### 5. Key Ordering

**Object keys:** Sort keys alphabetically when practical

**Rationale:** Consistent key ordering improves readability and reduces merge conflicts.

**Exceptions:**
- Package.json: Follow [npm package.json conventions](https://docs.npmjs.com/cli/v9/configuring-npm/package-json)
  (e.g., `name`, `version`, `description` come first)
- Semantic ordering may override alphabetical when it improves clarity

```json
// ✅ Preferred - alphabetically sorted
{
  "enabled": true,
  "name": "example",
  "timeout": 3000
}
```

#### 6. Line Length

**Maximum line length:** **120 characters** (consistent with Python/Markdown contracts)

**Rationale:** Matches repository-wide line length standard. Most lines should be shorter; use multi-line formatting
for complex structures.

**Enforcement:** Prettier will automatically wrap long lines where appropriate.

#### 7. Comments (JSONC Only)

**Single-line comments:** Use `//` for single-line comments

**Multi-line comments:** Use `/* ... */` for multi-line comments

**Comment style:** Comments should explain "why" not "what" (code should be self-documenting)

```jsonc
// ✅ Correct - explains why
{
  // Disabled due to incompatibility with prettier v3
  "trailingComma": "none"
}

// ❌ Incorrect - states the obvious
{
  // This sets the port to 8080
  "port": 8080
}
```

---

## Documentation Requirements

### JSON Files (`.json`)

Standard JSON **does NOT support comments** per RFC 8259 specification.

**Documentation approaches for `.json` files:**
- Use schema files (JSON Schema) to document structure
- Include README files in same directory
- Use special metadata fields (`$schema`, `description`, `version`, `name`)

See [docs/contributing/docstring-contracts/json-jsonc.md](docstring-contracts/json-jsonc.md) for details.

### JSONC Files (`.jsonc`)

JSONC files (JSON with Comments) **MUST include documentation**.

**Required file-level header:**
- Purpose/Description of the file
- Schema reference (if applicable)
- Last updated date (recommended)
- Usage notes (if needed)

**Format:**
```jsonc
// Purpose: Brief description of what this file configures
// Schema: Link to schema or format documentation (if applicable)
// Last Updated: YYYY-MM-DD

{
  "config": "value"
}
```

**Full documentation contract:** See [docs/contributing/docstring-contracts/json-jsonc.md](docstring-contracts/json-jsonc.md)

---

## Enforcement

### Tooling

**Primary tool:** [Prettier](https://prettier.io/) v3.4.2+

**Configuration:** Prettier configuration is defined in:
- `.prettierrc.json` (if present) - Repository-specific overrides
- Prettier defaults (when no config present)

### Verification

**Command:** `repo-lint check --ci`

**Checks performed:**
1. Prettier format verification (checks if files match expected format)
2. Exit code 0 = all files properly formatted
3. Exit code 1 = files need formatting

### Auto-fix

**Command:** `repo-lint fix`

**Behavior:**
- Runs `prettier --write` on all JSON/JSONC files
- Automatically fixes all formatting issues
- Safe and deterministic (idempotent)

---

## Examples

### Valid JSON File

```json
{
  "name": "example-config",
  "version": "1.0.0",
  "settings": {
    "enabled": true,
    "timeout": 3000,
    "retries": 3
  },
  "tags": ["production", "stable"]
}
```

### Valid JSONC File

```jsonc
{
  "name": "example-config",
  "version": "1.0.0",
  // Configuration settings
  "settings": {
    "enabled": true,
    "timeout": 3000,
    "retries": 3,
  },
  "tags": ["production", "stable"],
}
```

---

## Migration Guide

When adding JSON/JSONC linting to existing files:

1. **Backup** any existing files that may have formatting issues
2. Run `prettier --check '**/*.{json,jsonc}'` to see what needs formatting
3. Review diffs carefully before accepting automated changes
4. Run `prettier --write '**/*.{json,jsonc}'` to apply fixes
5. Verify files still parse correctly after formatting
6. Commit formatted files with clear commit message: "Format JSON/JSONC files per prettier contract"

---

## Rationale and References

### Why Prettier?

- **Industry standard:** Prettier is the de-facto standard for JSON/JS/TS formatting
- **Opinionated:** Reduces bikeshedding about style
- **Reliable:** Extensively tested and used by millions of projects
- **Fast:** Processes files quickly, suitable for CI
- **Integrations:** Works well with editors, CI/CD, and pre-commit hooks

### Why 2 Spaces?

- **JSON convention:** 2-space indentation is standard in JSON/JS ecosystem
- **Consistency:** Matches JavaScript, TypeScript, and Node.js conventions
- **Readability:** Sufficient indentation without excessive nesting

### Why Trailing Commas (JSONC)?

- **Better diffs:** Adding items doesn't modify the previous line
- **Easier refactoring:** Can reorder items without adjusting commas
- **Common practice:** Widely used in modern JavaScript/TypeScript codebases

---

## Compliance Checklist

Before committing JSON/JSONC files:

- [ ] File ends with single newline
- [ ] 2-space indentation used throughout
- [ ] No trailing whitespace
- [ ] Double quotes used for all strings
- [ ] Trailing commas only in JSONC files (not in JSON files)
- [ ] Line length ≤ 120 characters
- [ ] Comments (if JSONC) explain "why" not "what"
- [ ] `prettier --check` passes

---

## Tooling Commands

```bash
# Check formatting (CI mode)
repo-lint check --ci

# Fix formatting issues
repo-lint fix

# Check specific JSON/JSONC files with Prettier
prettier --check '**/*.{json,jsonc}'

# Format specific JSON/JSONC files
prettier --write '**/*.{json,jsonc}'

# Check a single file
prettier --check path/to/file.json
```

---

## Version History

- **2026-01-08:** Initial version (Phase 3.9 of Issue #278)
  - Established baseline JSON/JSONC formatting rules
  - Prettier v3.4.2 as enforcement tool
  - 2-space indentation, 120-char line length
  - Trailing commas policy (JSONC only)

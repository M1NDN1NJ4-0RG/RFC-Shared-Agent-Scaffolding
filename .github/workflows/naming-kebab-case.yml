# Workflow: Kebab-Case Naming Enforcement
#
# Purpose: Enforces kebab-case naming convention for script filenames in
# specific directories. Validates that executable entrypoint files (.sh, .bash,
# .zsh, .py, .pl, .ps1) follow the pattern: lowercase letters/digits, hyphens
# allowed only as separators between segments (e.g., safe-run.sh, run-tests.py).
#
# Scope:
# - wrappers/**
# - scripts/**
#
# Exclusions:
# - .rs files (Rust uses snake_case per ecosystem conventions)
# - Non-script files (documentation, data files, etc.)
#
# Triggers:
# - Pull requests (all paths)
# - Pushes to main branch
#
# Dependencies:
# - Python 3 (embedded validation script)
# - git ls-files
#
# Outputs:
# - Status check: "Kebab-Case Filename Validation"
# - Artifacts: None
# - Side effects: Fails if non-kebab-case filenames detected
#
# Notes:
# - Required for merge
# - Exit 0 = all files conform, non-zero = violations detected
---
name: naming-kebab-case

on:
  pull_request:
  push:
    branches: [main]

jobs:
  # Job: Kebab-Case Filename Validation
  # Uses embedded Python script to check filename patterns against regex
  kebab_case:
    # Runner: Ubuntu latest (provides Python 3 for validation script)
    runs-on: ubuntu-latest
    steps:
      # Step 1: Checkout repository to access all tracked files
      - uses: actions/checkout@v4

      # Step 2: Run kebab-case validation script
      # Inline Python script checks all script files in scope directories
      # Expected pattern: ^[a-z0-9]+(?:-[a-z0-9]+)*$ (stem only, without extension)
      - name: Enforce kebab-case for script files
        shell: bash
        run: |
          python3 - <<'PY'
          import re, subprocess, sys
          from pathlib import PurePosixPath

          ROOTS = [
            "wrappers/scripts",
            "scripts",
          ]

          # Script surface extensions only (executable entrypoints)
          # Explicitly excludes .rs (Rust uses snake_case per ecosystem conventions)
          EXTS = {".sh", ".bash", ".zsh", ".py", ".pl", ".ps1"}

          kebab = re.compile(r"^[a-z0-9]+(?:-[a-z0-9]+)*$")

          out = subprocess.check_output(["git", "ls-files", "-z"])
          files = [f.decode("utf-8") for f in out.split(b"\0") if f]

          def in_roots(path: str) -> bool:
            p = PurePosixPath(path)
            s = str(p)
            return any(s == root.rstrip("/") or s.startswith(root.rstrip("/") + "/") for root in ROOTS)

          bad = []
          for path in files:
            if not in_roots(path):
              continue
            p = PurePosixPath(path)
            suffix = p.suffix.lower()
            if suffix not in EXTS:
              continue
            stem = p.name[: -len(suffix)]
            if not kebab.match(stem):
              bad.append(path)

          if bad:
            print("❌ Non–kebab-case script filenames detected:\n")
            for f in sorted(bad):
              print(f" - {f}")
            print("\nExpected: lowercase letters/digits with hyphens only (e.g., safe-run.sh)")
            sys.exit(1)

          print("✅ Kebab-case filename check passed.")
          PY
